<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fogo Treasury Command Center</title>
  <meta name="description" content="CFO-level live token treasury dashboard for Fogo Foundation" />
  <style>
    :root {
      --bg: #05070f;
      --bg2: #0a1023;
      --panel: rgba(13, 21, 42, 0.72);
      --line: #2b3f72;
      --ink: #ecf3ff;
      --muted: #9ab0da;
      --cyan: #22d3ee;
      --violet: #8b5cf6;
      --pink: #ec4899;
      --green: #3ee6a8;
      --amber: #ffbe67;
    }
    * { box-sizing: border-box; }
    html, body { margin:0; padding:0; color:var(--ink); font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    body {
      background: radial-gradient(1000px 600px at 10% -20%, rgba(34,211,238,.15), transparent 70%),
                  radial-gradient(900px 600px at 90% -10%, rgba(139,92,246,.2), transparent 70%),
                  linear-gradient(180deg, var(--bg), var(--bg2));
      min-height: 100vh;
      overflow-x: hidden;
    }
    .fx { position: fixed; inset:0; pointer-events:none; }
    .gridfx { background-image: linear-gradient(rgba(130,155,220,.07) 1px, transparent 1px), linear-gradient(90deg, rgba(130,155,220,.07) 1px, transparent 1px); background-size: 34px 34px; mask-image: radial-gradient(circle at center, black 45%, transparent 100%); opacity:.45; }
    .scan { background: repeating-linear-gradient(to bottom, rgba(255,255,255,.06), rgba(255,255,255,.06) 1px, transparent 2px, transparent 5px); mix-blend-mode: soft-light; opacity:.08; animation: scan 7s linear infinite; }
    @keyframes scan { from { transform: translateY(-15%);} to { transform: translateY(15%);} }

    .wrap { max-width: 1400px; margin: 0 auto; padding: 26px; position: relative; }
    .hero {
      border:1px solid var(--line); border-radius: 20px; background: linear-gradient(150deg, rgba(14,24,50,.9), rgba(10,16,36,.74));
      padding: 22px; box-shadow: 0 20px 50px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.04);
      display: grid; grid-template-columns: 1.2fr .8fr; gap: 16px;
    }
    .badge { display:inline-flex; gap:8px; align-items:center; border:1px solid #3a568f; border-radius:999px; padding:6px 10px; color:#b8c9ef; font-size:12px; }
    .dot { width:8px; height:8px; border-radius:50%; background:var(--green); box-shadow:0 0 0 rgba(62,230,168,.5); animation:pulse 1.7s infinite; }
    @keyframes pulse { 70% { box-shadow:0 0 0 12px rgba(62,230,168,0);} 100% { box-shadow:0 0 0 0 rgba(62,230,168,0);} }
    h1 { margin:10px 0 8px; font-size:46px; line-height:1; letter-spacing:-.02em; }
    .sub { color:var(--muted); margin:0; }
    .sync { text-align:right; color: var(--muted); font-size:13px; }
    .sync b { color: #bfe8ff; }

    .kpi-grid { margin-top:16px; display:grid; grid-template-columns: repeat(6, 1fr); gap: 10px; }
    .kpi {
      border:1px solid var(--line); border-radius:14px; padding:10px;
      background:var(--panel); position:relative; overflow:hidden;
    }
    .kpi:before { content:""; position:absolute; inset:0; background:linear-gradient(120deg, transparent 20%, rgba(255,255,255,.08) 45%, transparent 60%); transform:translateX(-120%); animation:sweep 4.5s linear infinite; }
    @keyframes sweep { to { transform: translateX(120%);} }
    .k-label { font-size:11px; text-transform:uppercase; letter-spacing:.08em; color:#9fb3de; }
    .k-value { font-weight:800; font-size:26px; margin-top:5px; font-variant-numeric: tabular-nums; }
    .k-sub { font-size:12px; color:#9db4de; margin-top:2px; }

    .main { margin-top:14px; display:grid; grid-template-columns: 1.1fr .9fr; gap: 12px; }
    .card { border:1px solid var(--line); border-radius:16px; background:var(--panel); padding:14px; box-shadow: 0 12px 35px rgba(0,0,0,.3); }
    .card h3 { margin:0 0 10px; font-size:16px; letter-spacing:.02em; }

    table { width:100%; border-collapse: collapse; font-size:13px; }
    th, td { border-bottom:1px solid rgba(63,89,149,.45); padding:9px 6px; text-align:right; font-variant-numeric: tabular-nums; }
    th:first-child, td:first-child { text-align:left; }
    tr:hover td { background: rgba(140,163,231,.06); }

    .sparkline { width:100%; height:140px; border:1px solid #35508b; border-radius:12px; background: rgba(8,14,31,.7); }
    .bars { display:grid; gap:9px; }
    .bar-row { display:grid; grid-template-columns: 130px 1fr 80px; gap:10px; align-items:center; font-size:13px; }
    .bar-track { height:8px; background:rgba(74,97,151,.35); border-radius:999px; overflow:hidden; }
    .bar-fill { height:100%; background: linear-gradient(90deg, var(--cyan), var(--violet), var(--pink)); border-radius:999px; transition: width .8s ease; box-shadow: 0 0 12px rgba(139,92,246,.45); }

    .wallet-grid { display:grid; grid-template-columns: 1fr auto; gap:10px; margin-bottom:10px; }
    input { width:100%; border:1px solid #3a568f; border-radius:10px; background:#0b1430; color:#fff; padding:10px; }
    button { border:none; border-radius:10px; background:linear-gradient(90deg,var(--cyan),#6ee7ff); color:#03212e; font-weight:700; padding:10px 14px; cursor:pointer; }
    .muted { color: var(--muted); font-size:12px; }

    @media (max-width:1200px){ .kpi-grid { grid-template-columns: repeat(3,1fr);} .hero,.main { grid-template-columns:1fr; } }
    @media (max-width:700px){ .kpi-grid { grid-template-columns: repeat(2,1fr);} h1{font-size:34px;} .wrap{padding:14px;} }
  </style>
</head>
<body>
  <div class="fx gridfx"></div>
  <div class="fx scan"></div>
  <div class="wrap">
    <section class="hero">
      <div>
        <span class="badge"><span class="dot"></span> Fogo Foundation • Treasury Command Center</span>
        <h1>CFO Token Treasury Dashboard</h1>
        <p class="sub">Live tokenomics, chain throughput, supply diagnostics, validator concentration and treasury wallet monitoring.</p>
      </div>
      <div class="sync">
        <div>Last sync: <b id="lastSync">--:--:--</b></div>
        <div id="syncAge">Live feed warming up…</div>
        <div style="margin-top:8px" class="muted">Data sources: Fogo Mainnet RPC, CoinGecko, DeFiLlama</div>
      </div>
    </section>

    <section class="kpi-grid">
      <div class="kpi"><div class="k-label">Token Price</div><div class="k-value" id="price">—</div><div class="k-sub" id="chg">—</div></div>
      <div class="kpi"><div class="k-label">Market Cap</div><div class="k-value" id="mcap">—</div><div class="k-sub">USD</div></div>
      <div class="kpi"><div class="k-label">FDV</div><div class="k-value" id="fdv">—</div><div class="k-sub">USD</div></div>
      <div class="kpi"><div class="k-label">24h Volume</div><div class="k-value" id="vol">—</div><div class="k-sub">USD</div></div>
      <div class="kpi"><div class="k-label">Circulating Supply</div><div class="k-value" id="circ">—</div><div class="k-sub" id="supplyRatio">—</div></div>
      <div class="kpi"><div class="k-label">TVL</div><div class="k-value" id="tvl">—</div><div class="k-sub">DeFiLlama</div></div>

      <div class="kpi"><div class="k-label">Live TPS</div><div class="k-value" id="tps">—</div><div class="k-sub">Transactions / second</div></div>
      <div class="kpi"><div class="k-label">Txns (24h)</div><div class="k-value" id="tx24">—</div><div class="k-sub">Estimated from live samples</div></div>
      <div class="kpi"><div class="k-label">Cumulative Txns</div><div class="k-value" id="txTotal">—</div><div class="k-sub">From epoch info</div></div>
      <div class="kpi"><div class="k-label">Current Epoch</div><div class="k-value" id="epoch">—</div><div class="k-sub" id="epochProgress">—</div></div>
      <div class="kpi"><div class="k-label">Total Stake</div><div class="k-value" id="stake">—</div><div class="k-sub" id="stakingRatio">—</div></div>
      <div class="kpi"><div class="k-label">Validators</div><div class="k-value" id="validators">—</div><div class="k-sub">Active vote accounts</div></div>
    </section>

    <section class="main">
      <div class="card">
        <h3>Real-Time Throughput Signal</h3>
        <canvas id="spark" class="sparkline" width="900" height="180"></canvas>
        <div class="muted" style="margin-top:8px">Rolling live TPS signal from mainnet performance samples. Refreshes every 12s with smooth in-between rendering.</div>
      </div>
      <div class="card">
        <h3>Supply Composition</h3>
        <div class="bars">
          <div class="bar-row"><div>Circulating</div><div class="bar-track"><div id="barCirc" class="bar-fill" style="width:0%"></div></div><div id="txtCirc">—</div></div>
          <div class="bar-row"><div>Non-Circulating</div><div class="bar-track"><div id="barNonCirc" class="bar-fill" style="width:0%"></div></div><div id="txtNonCirc">—</div></div>
          <div class="bar-row"><div>Staked</div><div class="bar-track"><div id="barStaked" class="bar-fill" style="width:0%"></div></div><div id="txtStaked">—</div></div>
        </div>
      </div>
    </section>

    <section class="main">
      <div class="card">
        <h3>Validator Concentration Snapshot</h3>
        <table>
          <thead><tr><th>Validator</th><th>Activated Stake</th><th>Share</th></tr></thead>
          <tbody id="validatorRows"><tr><td colspan="3">Loading…</td></tr></tbody>
        </table>
      </div>
      <div class="card">
        <h3>Treasury Wallet Monitor (Foundation)</h3>
        <div class="wallet-grid">
          <input id="walletInput" placeholder="Paste Fogo wallet address and press Add" />
          <button id="addWallet">Add</button>
        </div>
        <table>
          <thead><tr><th>Wallet</th><th>Balance (FOGO)</th><th>USD Value</th></tr></thead>
          <tbody id="walletRows"><tr><td colspan="3">No wallets added yet.</td></tr></tbody>
        </table>
        <div class="muted" style="margin-top:8px">Wallet list is saved in your browser for portability on each machine profile.</div>
      </div>
    </section>
  </div>

  <script>
    const state = { lastSyncMs: null, tpsSeries: [], wallets: JSON.parse(localStorage.getItem('fogo_wallets') || '[]') };

    const el = (id) => document.getElementById(id);
    const fmtUsd = (n) => (n == null || !isFinite(n)) ? '—' : new Intl.NumberFormat('en-US', { style:'currency', currency:'USD', notation: n > 1e9 ? 'compact' : 'standard', maximumFractionDigits: 2 }).format(n);
    const fmtNum = (n) => (n == null || !isFinite(n)) ? '—' : new Intl.NumberFormat('en-US', { maximumFractionDigits: 2 }).format(n);
    const fmtCompact = (n) => (n == null || !isFinite(n)) ? '—' : new Intl.NumberFormat('en-US', { notation:'compact', maximumFractionDigits: 2 }).format(n);

    async function rpc(method, params=[]) {
      const r = await fetch('https://mainnet.fogo.io', { method:'POST', headers:{'content-type':'application/json'}, body: JSON.stringify({jsonrpc:'2.0', id:1, method, params}) });
      const j = await r.json();
      return j.result;
    }

    async function fetchMarket() {
      const r = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&ids=fogo&price_change_percentage=24h', { cache:'no-store' });
      const j = await r.json();
      return Array.isArray(j) ? j[0] : null;
    }

    async function fetchTvl() {
      const r = await fetch('https://api.llama.fi/v2/chains', { cache:'no-store' });
      const j = await r.json();
      const fogo = (Array.isArray(j) ? j.find(x => x.name === 'Fogo') : null) || null;
      return fogo?.tvl ?? null;
    }

    function updateSync() {
      if (!state.lastSyncMs) return;
      const s = Math.floor((Date.now() - state.lastSyncMs) / 1000);
      el('syncAge').textContent = `Last pull ${s}s ago • Auto-refresh every 12s`;
    }

    function drawSpark() {
      const cvs = el('spark'); const ctx = cvs.getContext('2d');
      const arr = state.tpsSeries.slice(-80);
      ctx.clearRect(0,0,cvs.width,cvs.height);
      ctx.fillStyle = 'rgba(10,18,36,.7)'; ctx.fillRect(0,0,cvs.width,cvs.height);
      if (!arr.length) return;
      const min = Math.min(...arr), max = Math.max(...arr), span = (max-min)||1;
      const pad=16, w=cvs.width-pad*2, h=cvs.height-pad*2;
      ctx.strokeStyle='rgba(68,98,162,.45)'; ctx.lineWidth=1;
      for(let i=0;i<4;i++){ const y = pad + (h/3)*i; ctx.beginPath(); ctx.moveTo(pad,y); ctx.lineTo(pad+w,y); ctx.stroke(); }

      ctx.beginPath();
      arr.forEach((v,i)=>{
        const x = pad + (i/(arr.length-1||1))*w;
        const y = pad + h - ((v-min)/span)*h;
        if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
      });
      ctx.strokeStyle = '#22d3ee'; ctx.lineWidth=2.4; ctx.shadowBlur=12; ctx.shadowColor='rgba(34,211,238,.7)'; ctx.stroke(); ctx.shadowBlur=0;

      const last = arr[arr.length-1];
      const x = pad + w, y = pad + h - ((last-min)/span)*h;
      ctx.beginPath(); ctx.arc(x,y,4.5,0,Math.PI*2); ctx.fillStyle='#3ee6a8'; ctx.fill();
    }

    function setBars(circ, total, staked) {
      if (!total || !isFinite(total)) return;
      const non = Math.max(total - (circ||0), 0);
      const pCirc = Math.max(0, Math.min(100, ((circ||0)/total)*100));
      const pNon = Math.max(0, 100 - pCirc);
      const pSt = Math.max(0, Math.min(100, ((staked||0)/total)*100));
      el('barCirc').style.width = pCirc + '%';
      el('barNonCirc').style.width = pNon + '%';
      el('barStaked').style.width = pSt + '%';
      el('txtCirc').textContent = pCirc.toFixed(2)+'%';
      el('txtNonCirc').textContent = pNon.toFixed(2)+'%';
      el('txtStaked').textContent = pSt.toFixed(2)+'%';
    }

    async function refreshWallets(price) {
      const body = el('walletRows');
      if (!state.wallets.length) {
        body.innerHTML = '<tr><td colspan="3">No wallets added yet.</td></tr>'; return;
      }
      const rows = await Promise.all(state.wallets.map(async (w) => {
        try {
          const lamports = await rpc('getBalance', [w, {commitment:'confirmed'}]).then(x=>x?.value);
          const bal = (lamports||0) / 1e9;
          return { w, bal };
        } catch { return { w, bal: null }; }
      }));
      body.innerHTML = rows.map(r => `<tr><td style="max-width:280px;overflow:hidden;text-overflow:ellipsis">${r.w}</td><td>${fmtNum(r.bal)}</td><td>${r.bal == null || !price ? '—' : fmtUsd(r.bal * price)}</td></tr>`).join('');
    }

    async function refresh() {
      try {
        const [market, tvl, perf, epoch, vote, supply] = await Promise.all([
          fetchMarket(),
          fetchTvl(),
          rpc('getRecentPerformanceSamples', [60]),
          rpc('getEpochInfo', []),
          rpc('getVoteAccounts', []),
          rpc('getSupply', [{commitment:'confirmed'}]),
        ]);

        const samples = Array.isArray(perf) ? perf : [];
        const totalTx = samples.reduce((a,s)=>a + Number(s?.numTransactions || 0),0);
        const totalSecs = samples.reduce((a,s)=>a + Number(s?.samplePeriodSecs || 0),0);
        const tps = totalTx && totalSecs ? totalTx / totalSecs : null;
        const tx24 = tps ? tps * 86400 : null;
        if (tps) state.tpsSeries.push(tps);

        const circ = market?.circulating_supply ?? null;
        const totalSupply = market?.total_supply ?? supply?.value?.total / 1e9 ?? null;
        const activeVotes = vote?.current || [];
        const totalStakeLamports = activeVotes.reduce((a,v)=> a + Number(v.activatedStake || 0), 0);
        const totalStake = totalStakeLamports / 1e9;

        el('price').textContent = fmtUsd(market?.current_price);
        el('chg').textContent = market?.price_change_percentage_24h != null ? `${market.price_change_percentage_24h.toFixed(2)}% (24h)` : '—';
        el('mcap').textContent = fmtUsd(market?.market_cap);
        el('fdv').textContent = fmtUsd(market?.fully_diluted_valuation);
        el('vol').textContent = fmtUsd(market?.total_volume);
        el('circ').textContent = fmtCompact(circ);
        el('supplyRatio').textContent = (circ && totalSupply) ? `${((circ/totalSupply)*100).toFixed(2)}% of total supply` : '—';
        el('tvl').textContent = fmtUsd(tvl);

        el('tps').textContent = fmtNum(tps);
        el('tx24').textContent = fmtCompact(tx24);
        el('txTotal').textContent = fmtCompact(epoch?.transactionCount || null);
        el('epoch').textContent = epoch?.epoch ?? '—';
        el('epochProgress').textContent = epoch?.slotsInEpoch ? `${((epoch.slotIndex/epoch.slotsInEpoch)*100).toFixed(2)}% through epoch` : '—';
        el('stake').textContent = fmtCompact(totalStake);
        el('stakingRatio').textContent = totalSupply ? `${((totalStake/totalSupply)*100).toFixed(2)}% staking ratio` : '—';
        el('validators').textContent = activeVotes.length || '—';

        setBars(circ, totalSupply, totalStake);

        const top = [...activeVotes].sort((a,b)=>Number(b.activatedStake||0)-Number(a.activatedStake||0)).slice(0,10);
        const rows = top.map(v=>{
          const stake = Number(v.activatedStake||0)/1e9;
          const share = totalStake ? (stake/totalStake)*100 : 0;
          const name = (v.nodePubkey||'').slice(0,6)+'…'+(v.nodePubkey||'').slice(-6);
          return `<tr><td>${name}</td><td>${fmtCompact(stake)}</td><td>${share.toFixed(2)}%</td></tr>`;
        }).join('');
        el('validatorRows').innerHTML = rows || '<tr><td colspan="3">No validator data</td></tr>';

        await refreshWallets(market?.current_price || null);

        const now = Date.now();
        state.lastSyncMs = now;
        el('lastSync').textContent = new Date(now).toLocaleTimeString();
        updateSync();
        drawSpark();
      } catch (e) {
        el('syncAge').textContent = 'Data fetch error. Retrying automatically…';
      }
    }

    el('addWallet').addEventListener('click', () => {
      const w = el('walletInput').value.trim();
      if (!w) return;
      if (!state.wallets.includes(w)) state.wallets.push(w);
      localStorage.setItem('fogo_wallets', JSON.stringify(state.wallets));
      el('walletInput').value = '';
      refresh();
    });

    setInterval(updateSync, 1000);
    setInterval(drawSpark, 1000);
    refresh();
    setInterval(refresh, 12000);
  </script>
</body>
</html>